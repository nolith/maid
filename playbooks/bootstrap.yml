---
- name: print from playbook
  debug: msg="in bootstrap.yml"

- name: install linuxbrew deps
  apt: name={{item}} state=present update_cache=yes
  sudo: yes
  when: ansible_os_family == 'Debian'
  with_items:
    - zsh
    - build-essential
    - curl
    - git
    - m4
    - ruby
    - texinfo
    - libbz2-dev
    - libcurl4-openssl-dev
    - libexpat-dev
    - libncurses-dev
    - zlib1g-dev

- name: clone dotfiles
  git: repo=git@bitbucket.org:nolith/.dotfiles.git dest={{home}}/.dotfiles force=yes update=no accept_hostkey=yes
  sudo: false

- name: install prezto
  git: repo=https://github.com/sorin-ionescu/prezto.git dest={{home}}/.zprezto force=no update=yes
  sudo: false

- name: install linuxbrew
  git: repo=https://github.com/Homebrew/linuxbrew.git dest=/opt/homebrew depth=1
  when: ansible_os_family == 'Debian' or ansible_os_family == 'Redhat'
  sudo: true

- name: chown linuxbrew
  file: >
    path=/opt/homebrew
    owner={{ user }}
    group={{ user }}
    recurse=yes
  when: ansible_os_family == 'Debian' or ansible_os_family == 'Redhat'
  sudo: true

- name: making RBENV_ROOT
  file: path={{ rbenv_root }} state=directory owner={{ user }}

- name: making /opt/rubies
  file: path=/opt/rubies state=directory owner={{ user }}
  sudo: true

- name: making RBENV_ROOT/versions
  file: >
    src=/opt/rubies
    dest={{ rbenv_root }}/versions
    state=link

- name: making src folder
  file: dest={{ home }}/src state=directory owner={{ user }}
  sudo: false

- name: linking maid to our-maid
  file: >
    src=/opt/maid
    dest={{ home }}/src/our-maid
    state=link
  sudo: false

# - name: easy install pip
#   easy_install: name=pip
#   sudo: yes
#
# - name: install apps from pip
#   pip: name={{item}}
#   sudo: yes
#   with_items:
#       - virtualenv
#       - cliff
#       - pyyaml
#       - awscli
#
- name: install homebrew_taps
  homebrew_tap: tap={{item}} state=present
  sudo: false
  with_items:
      - thoughtbot/formulae

- name: install apps from homebrew
  sudo: false
  homebrew: name={{item}} state=present update_homebrew=yes
  with_items:
      - rbenv
      - ruby-build
      - rcm
      - tmux
      - ack

- name: update .dotfiles
  sudo: false
  shell: rcup -v



# requires node/npm from above
# - name: install global apps from npm
#   npm: name={{item}} global=yes
#   with_items:
#       - grunt-cli

#    - name: install gvm the Groovy enVironment Manager
#      mac_pkg: pkg_type=script script_creates=/usr/local/bin/gvm
#               script_prefix="echo | " script_exe=bash
#               url=http://get.gvmtool.net

# - name: create homdir symlinks
#   file: src={{item.from}} dest={{item.to}} state=link
#   sudo: no
#   with_items:
#      # ~/Dropbox/ubuntu/* is now deprecated for Mackup and ~/Dropbox/Mackup
#      - from: ~/Dropbox/mac/bin
#        to: ~/bin

#    - name: install gems
#      gem: name={{item}} state=latest
#      with_items:
#          - brewbygems
#          - bundler
#          - compass
